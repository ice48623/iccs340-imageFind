<html>
  <head>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  </head>
  <body>
    <!-- <script src="js/masonry.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.js"></script>
    <script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>

    <div class="container">
      <h1>Masonry - appended</h1>
      <p><button class="append-button">Append new items</button></p>

      <!-- Search Result -->
      <div class="grid">
      </div>

      <!-- The Modal -->
      <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="image-modal-content">

          <div class="modal-img-content">

            <div class="image-modal-header">

              <h1 id="modal-img-id"></h1>
            </div>

            <div class="image-modal-body">
              <img id="modal-img">
            </div>
          </div>

          <div class="modal-user-info">
            <span class="close">&times;</span>
            <div class="user-info-wrapper">
              <div id="modal-user-avatar-wrapper" class="center-block">
                <img id="modal-user-avatar" class="img-responsive img-circle">
              </div>
              <h2 id="modal-user-fullname"></h2>
              <div id="modal-camera">
                <div id="modal-camera-info">
                  <img id="camera-vector" src="./assets/img/camera.png">
                  <h5 id="camera-model"></h5>
                  <h5 id="lens-model"></h5>
                </div>
                <div id="modal-camera-setting">
                  <div id="aperture">
                    <img class="left" src="./assets/img/aperture.png">
                    <p class="left" id="aperture-info"></p>
                  </div>
                  <div id="shutter-speed">
                    <img class="left" src="./assets/img/shutter-speed.png">
                    <p class="left" id="shutter-speed-info"></p>
                  </div>
                  <div id="iso">
                    <img class="left" src="./assets/img/iso.png">
                    <p class="left" id="iso-info"></p>
                  </div>
                </div>
              </div>

            </div>
          </div>


        </div>

      </div>

    </div>

  </body>

  <script>

    var $grid = $('.grid').masonry({
      columnWidth: 50,
      itemSelector: '.grid-item'
    });

    $('.append-button').on( 'click', function() {
      genImage_500px();
    });

    var cus_key = "consumer_key=oHqaYKxBd5NTq4xZMG1cchZuluycWyr2BI4Ehng4";

    function genImage_500px(){
      // var cus_key = "consumer_key=oHqaYKxBd5NTq4xZMG1cchZuluycWyr2BI4Ehng4";
      var url = "https://api.500px.com/v1/photos/search?term=" + "nature" + "&" + cus_key + "&image_size=1080"
      $.get(url,function(json){
        $.each(json.photos,function(i, item){
          // console.log(item);
          var $item = $('<img id="' + item.id + '" class="grid-item" src="'+ item.image_url + '"onclick="openModel(' + item.id + ')">');
          $grid.append( $item ).masonry( 'appended', $item );
          $grid.masonry('layout');
        })
      })
    }

    function genImageModal(imageID){
      // clearBox("myModal");
      // var cus_key = "consumer_key=oHqaYKxBd5NTq4xZMG1cchZuluycWyr2BI4Ehng4";
      var image_size = "image_size=4"
      var url = "https://api.500px.com/v1/photos/" + imageID + "?" + image_size + "&" + cus_key;
      $.get(url,function(json){
        var image = json.photo;
        var user_id = image.user_id;
        var name = image.name;
        var image_url  = image.image_url;
        console.log(image);
        document.getElementById("modal-img-id").innerHTML = name + " - " + imageID;
        document.getElementById("modal-img").setAttribute("src", image_url);
        document.getElementById("camera-model").innerHTML = image.camera;
        document.getElementById("lens-model").innerHTML = image.lens;
        document.getElementById("aperture-info").innerHTML = image.aperture;
        document.getElementById("shutter-speed-info").innerHTML = image.shutter_speed;
        document.getElementById("iso-info").innerHTML = image.iso;
        genUserInfo(user_id);
      })


    }

    function genUserInfo(user_id){
      var url = "https://api.500px.com/v1/users/show?id=" + user_id + "&" + cus_key;
      $.get(url,function(json){
        var user = json.user;
        var fullname = user.firstname + " " + user.lastname;
        console.log(fullname);
        document.getElementById("modal-user-fullname").innerHTML = fullname;
        document.getElementById("modal-user-avatar").setAttribute("src", user.userpic_url);

      })
    }

    function openModel(imageID){
      // Get the modal
      console.log(imageID);
      var modal = document.getElementById('myModal');

      // Get the button that opens the modal
      // var btn = document.getElementById('id');
      // console.log(btn);
      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];

      //When the user clicks the button, open the modal
      // btn.onclick = function() {
      //     modal.style.display = "block";
      // }

      modal.style.display = "block";

      // When the user clicks on <span> (x), close the modal
      span.onclick = function() {
          modal.style.display = "none";
      }

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function(event) {
          if (event.target == modal) {
              modal.style.display = "none";
          }
      }

      genImageModal(imageID);
    }


  </script>

</html>
