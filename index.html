<html>
  <head>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  </head>
  <body>
    <!-- <script src="js/masonry.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.js"></script>
    <script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>

    <div class="container">
      <h1>Masonry - appended</h1>
      <p><button class="append-button">Append new items</button></p>

      <!-- Search Result -->
      <div class="grid">
      </div>

      <!-- The Modal -->
      <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close">&times;</span>
            <h1 id="modal-img-id"></h1>
          </div>
          <div class="modal-body">

            <img id="modal-img">
          </div>
        </div>

      </div>

    </div>

  </body>

  <script>
    // external js: masonry.pkgd.js

    var $grid = $('.grid').masonry({
      columnWidth: 50,
      itemSelector: '.grid-item'
    });

    $('.append-button').on( 'click', function() {

      genImage_500px();
      // openModel();
      // var elems = [ getItemElement(), getItemElement(), getItemElement() ];
      // var $item = $('<img class="grid-item" src=http://eskipaper.com/images/landscape-sunset-15.jpg>');
      // var $elems = $( elems );
      // $grid.append( $item ).masonry( 'appended', $item );
    });

    // create <div class="grid-item"></div>
    function getItemElement() {
      var elem = document.createElement('div');
      var wRand = Math.random();
      var hRand = Math.random();
      var widthClass = wRand > 0.8 ? 'grid-item--width3' : wRand > 0.6 ? 'grid-item--width2' : '';
      var heightClass = hRand > 0.85 ? 'grid-item--height4' : hRand > 0.6 ? 'grid-item--height3' : hRand > 0.35 ? 'grid-item--height2' : '';
      elem.className = 'grid-item ' + widthClass + ' ' + heightClass;
      return elem;
    }

    function genImage_500px(){
      var cus_key = "consumer_key=oHqaYKxBd5NTq4xZMG1cchZuluycWyr2BI4Ehng4";
      var url = "https://api.500px.com/v1/photos/search?term=" + "nature" + "&" + cus_key + "&image_size=1080"
      $.get(url,function(json){
        $.each(json.photos,function(i, item){
          // console.log(item);
          var $item = $('<img id="' + item.id + '" class="grid-item" src="'+ item.image_url + '"onclick="openModel(' + item.id + ')">');
          $grid.append( $item ).masonry( 'appended', $item );
          $grid.masonry('layout');
        })
      })
    }

    function genImageModal(imageID){
      // clearBox("myModal");
      var cus_key = "consumer_key=oHqaYKxBd5NTq4xZMG1cchZuluycWyr2BI4Ehng4";
      var image_size = "image_size=4"
      var url = "https://api.500px.com/v1/photos/" + imageID + "?" + image_size + "&" + cus_key;
      $.get(url,function(json){
        var image = json.photo;
        var user = image.user;
        var name = image.name;
        var image_url  = image.image_url;
        console.log(image);
        document.getElementById("modal-img-id").innerHTML = imageID;

        var img_elem = document.createElement("img");
        img_elem.setAttribute("src", image_url);
        document.getElementById("modal-img").setAttribute("src", image_url);
      })
    }

    function clearBox(elementID) {
      document.getElementById(elementID).innerHTML = "";
    }

    function openModel(imageID){
      // Get the modal
      console.log(imageID);
      var modal = document.getElementById('myModal');

      // Get the button that opens the modal
      // var btn = document.getElementById('id');
      // console.log(btn);
      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];

      //When the user clicks the button, open the modal
      // btn.onclick = function() {
      //     modal.style.display = "block";
      // }

      modal.style.display = "block";

      // When the user clicks on <span> (x), close the modal
      span.onclick = function() {
          modal.style.display = "none";
      }

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function(event) {
          if (event.target == modal) {
              modal.style.display = "none";
          }
      }

      genImageModal(imageID);
    }


  </script>

</html>
